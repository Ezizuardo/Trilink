{% extends "base.html" %}
{% block title %}{{ t('search') }}{% endblock %}
{% block content %}
<h1><span class="icon icon-search"></span>{{ t('search') }}</h1>
<form class="searchbar" method="get">
  <input name="q" value="{{ q }}" placeholder="Имя, @ник или направление">
  <button class="btn strong" type="submit">Найти</button>
</form>
<div class="grid-cards">
  {% for p in people %}
  {% set course = p.courses[0] if p.courses else None %}
  {% set videos = course.videos if course else [] %}
  <a class="card person" href="{{ url_for('public_profile', user_id=p.id) }}">
    <div class="person-preview" data-preview-card data-preview-src="{{ videos[0].file_url if videos else '' }}" style="background-image:url('{{ course.preview_image if course else '/static/img/course_placeholder.svg' }}')">
      {% if course and course.price is not none %}
      <span class="price-bubble">{{ "{:,.0f}".format(course.price).replace(',', ' ') }} ₽</span>
      {% endif %}
      <video muted playsinline preload="metadata"></video>
    </div>
    <div class="person-body">
      <div class="person-row">
        <img class="avatar-mini" src="{{ avatar_url(p) }}" alt="{{ p.nickname or p.first_name }}">
        <div>
          <div class="p-name">{{ p.first_name or 'Без имени' }} {{ p.last_name or '' }}</div>
          <div class="muted">@{{ p.nickname or 'без_ника' }}</div>
        </div>
      </div>
      {% if course %}
      <div class="course-snippet">
        <strong>{{ course.title }}</strong>
        <span class="muted">{{ videos|length }} видео</span>
      </div>
      {% endif %}
      <div class="tags">{{ p.specialist.keywords if p.specialist else (p.student.looking_for if p.student else '') }}</div>
      <div class="person-actions">
        <span>Перейти к профилю</span>
        <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="m9 5 7 7-7 7-1.41-1.41L13.17 12 7.59 6.41 9 5Z"/></svg>
      </div>
    </div>
  </a>
  {% endfor %}
  {% if not people %}
  <div class="card muted">По вашему запросу ничего не найдено.</div>
  {% endif %}
</div>
{% endblock %}
