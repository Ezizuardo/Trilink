{% extends "base.html" %}
{% block title %}{{ t('search') }}{% endblock %}
{% block content %}
<h1><span class="icon icon-search"></span>{{ t('search') }}</h1>
<form class="searchbar" method="get">
  <input name="q" value="{{ q }}" placeholder="Имя, @ник или направление">
  <button class="btn strong" type="submit">Найти</button>
</form>
<div class="grid-cards">
  {% for entry in results %}
  {% set person = entry.person %}
  {% set course = entry.course %}
  <a class="card person course-card" href="{{ url_for('public_profile', user_id=person.id, course_id=course.id if course else None) }}">
    <div class="course-card-header">
      <div class="course-thumb" {% if course and course.cover_image %}style="background-image:url('{{ course.cover_image }}')"{% endif %}>
        {% if not course or not course.cover_image %}
        <span class="course-thumb-placeholder">Изображение появится после загрузки</span>
        {% endif %}
        {% if course and course.videos %}
        <span class="course-count">{{ course.videos|length }} видео</span>
        {% endif %}
      </div>
      {% if course and course.price is not none %}
      <span class="price-tag">{{ format_price(course.price) }}</span>
      {% endif %}
    </div>
    <div class="person-row">
      <img class="avatar-mini" src="{{ avatar_url(person) }}" alt="{{ person.nickname or person.first_name }}">
      <div>
        <div class="p-name">{{ person.first_name or 'Без имени' }} {{ person.last_name or '' }}</div>
        <div class="muted">@{{ person.nickname or 'без_ника' }}</div>
      </div>
    </div>
    <div class="tags">
      {% if course %}
        {{ course.subject or 'Без предмета' }}{% if course.topic %} · {{ course.topic }}{% endif %}
      {% else %}
        {{ person.specialist.keywords if person.specialist else (person.student.looking_for if person.student else '') }}
      {% endif %}
    </div>
    <div class="preview-info">
      {% if course %}
      <div class="preview-title">{{ course.title }}</div>
      <div class="muted small">Интенсив специалиста {{ person.first_name or person.nickname or person.email }}</div>
      {% else %}
      <div class="muted small">Специалист ещё не опубликовал интенсив.</div>
      {% endif %}
    </div>
    <div class="person-actions">
      <span>Перейти к интенсиву</span>
      <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="m9 5 7 7-7 7-1.41-1.41L13.17 12 7.59 6.41 9 5Z"/></svg>
    </div>
  </a>
  {% endfor %}
  {% if not results %}
  <div class="card muted">По вашему запросу ничего не найдено.</div>
  {% endif %}
</div>
{% endblock %}
